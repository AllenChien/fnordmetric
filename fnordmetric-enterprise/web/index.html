<html>
  <head>
    <title>FnordMetric Enterprise</title>
    <link href="web.css" rel="stylesheet" type="text/css" />
    <link href="../../fnordmetric-ui/fnordmetric-ui.css" rel="stylesheet" type="text/css" />
    <script src="../../fnordmetric-ui/fnordmetric-ui.js" type="text/javascript"></script>
    <script src="jQuery-1.6.2.min.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="navbar">
      <a href="#">Settings</a>
      <a href="#">Documentation</a>
      <h1>
        FnordMetric Enterprise
        <span style="font-weight:normal; font-size:80%; margin-left:5px;">v1.2.8</span>
      </h1>
    </div>

    <div id="sidebar">
      <div class="searchbar">
        <input placeholder="Search..."  type="search" onKeyUp="FnordMetric.enterprise_ui.renderMetricList();" onChange="FnordMetric.enterprise_ui.renderMetricList();" />
      </div>

      <ul class="ui_toplist loading" id="metric_list">
      </ul>
    </div>

    <div id="pane">
      <div class="ge_controlpanel">
        <div class="ge_controlpanel_section" style="border-right:none; padding-right:0;">
          <label>Select the Timerange</label>
          <a class="button datepicker_sa">
            <div class="date" style="width:300px;">&nbsp;</div>
          <i class="icon-calendar"></i>
          </a>
        </div>

        <div class="ge_controlpanel_section">
          <label>...or a Recent Interval</label>
          <a class="button datepicker_sa">
            <div class="date" style="width:100px;">&nbsp;</div>
          </a>
        </div>

        <div class="ge_controlpanel_section">
          <label>Export as...</label>
          <div class="buttons">
            <a class="button navbutton">CSV</a>
            <a class="button navbutton">JSON</a>
            <a class="button navbutton">XML</a>
          </div>
        </div>
      </div>

      <div class="headbar">
        <a class="button mr">Fnord</a>
        <h2>fnord.bar.mymetric</h2>
      </div>

      <div style="clear:both;" class="widget_viewport">
        <i class="ge_empty">Please select a gauge...</i>
      </div>

    </div>

    <script type="text/javascript">

      FnordMetric.setup({
        "address": "localhost:8080"
      });


      FnordMetric.enterprise_ui = (function(){
        var metric_list = false;
            update_metric_list_timer = false;

        function updateMetricList() {
          FnordMetric.execute("LIST", function(d){
            if (metric_list == false) {
              window.clearInterval(update_metric_list_interval);
              update_metric_list_interval = window.setInterval(updateMetricList, 2000);
              $("#metric_list").removeClass("loading");
            }

            metric_list = d.split(" ");
            renderMetricList();
          });
        }

        function renderMetricList() {
          var ul = $("#metric_list");
          ul.html("");

          var search_prefix = $(".searchbar input:first").val();

          for (ind in metric_list) {
            if (ind > 100)
              break;

            var match = search_prefix == "" ? true : false;

            if (!match)
              match = (metric_list[ind].substring(0, search_prefix.length) == search_prefix);

            if (match)
              ul.append($("<li>").html(metric_list[ind]));
          }
        }


        update_metric_list_interval = window.setInterval(updateMetricList, 200);

        return {
          renderMetricList: renderMetricList
        };

      })();
    </script>
  </body>
</html>
